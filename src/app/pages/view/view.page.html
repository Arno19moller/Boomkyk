<ion-header [translucent]="true" style="background-color: transparent; box-shadow: none">
  <ion-buttons slot="start" style="margin-top: 25px; margin-left: 10px; z-index: 3000">
    <ion-button (click)="goBack()">
      <ion-icon slot="icon-only" name="arrow-back-outline"></ion-icon>
    </ion-button>
  </ion-buttons>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-header collapse="condense" style="background-color: transparent; box-shadow: none">
    <ion-buttons slot="start" style="margin-top: 25px; margin-left: 10px; z-index: 3000">
      <ion-button (click)="goBack()">
        <ion-icon slot="icon-only" name="arrow-back-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-header>

  @if(selectedItem() != undefined){
  <swiper-container
    style="
      --swiper-navigation-color: #fff;
      --swiper-pagination-color: #fff;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      object-fit: cover;
    "
    zoom="true"
    navigation="true"
    pagination="true"
    pagination-clickable="true"
    [ngStyle]="{'height': imgHeight + '%'}"
  >
    @for (image of images(); track $index) {
    <swiper-slide lazy="true">
      <div class="swiper-zoom-container">
        <img class="tree-image" loading="lazy" [src]="image.webPath" (error)="handleImageError($event)" />
      </div>
    </swiper-slide>
    }
  </swiper-container>
  }

  <ion-modal
    [isOpen]="isModalOpen"
    [initialBreakpoint]="0.6"
    [breakpoints]="[0.1, 0.3, 0.6, 0.9]"
    [backdropDismiss]="false"
    [backdropBreakpoint]="1"
    (didDismiss)="goBack()"
    cssClass="item-content"
  >
    <ng-template>
      @if(selectedItem() != undefined){
      <ion-header style="display: flex; justify-content: center; align-items: center; flex-direction: column">
        <ion-button
          id="action-button"
          fill="none"
          shape="round"
          style="position: absolute; top: 5px; right: 0px"
        >
          <ion-icon name="ellipsis-vertical-outline" slot="icon-only"></ion-icon>
        </ion-button>
        <ion-popover trigger="action-button" dismissOnSelect="true">
          <ng-template>
            <ion-content>
              <ion-list lines="none">
                <ion-item button (click)="editItem()">
                  <ion-icon aria-hidden="true" name="create" slot="start"></ion-icon>
                  <ion-label>Edit</ion-label>
                </ion-item>
                <ion-item button (click)="confirmDelete()">
                  <ion-icon aria-hidden="true" name="trash" slot="start" color="danger"></ion-icon>
                  <ion-label color="danger">Delete</ion-label>
                </ion-item>
              </ion-list>
            </ion-content>
          </ng-template>
        </ion-popover>
        <h2 style="margin-bottom: 5px">{{selectedItem()!.name}}</h2>
        <sub style="margin-bottom: 15px; display: flex; justify-content: center; align-items: center; width: 100%">
          @for (hierarchy of selectedItem()!.categoryHierarchy; track $index) { {{hierarchy}} @if (!$last) {
          <ion-icon name="chevron-forward-outline"></ion-icon>
          } }
        </sub>
      </ion-header>
      <ion-content>
        <ion-list class="form-container" lines="none" style="margin-top: 10px; border-radius: 7px">
          <ion-item>
            <ion-textarea
              labelPlacement="stacked"
              placeholder="Enter notes here"
              style="margin-top: 10px"
              autoGrow="true"
              style="color: white"
              [disabled]="false"
              [(ngModel)]="selectedItem()!.notes"
            >
            </ion-textarea>
          </ion-item>
        </ion-list>
        <app-voice [audioFiles]="audioFiles()" [selectedCategoryItem]="selectedItem()"></app-voice>
        <ion-accordion-group (ionChange)="onAccordionChange($event)" style="margin: 10px 10px; border-radius: 7px; overflow: hidden;">
          <ion-accordion value="map">
            <ion-item slot="header" color="light">
              <ion-label>Map Location</ion-label>
            </ion-item>
            <div slot="content" style="padding: 10px 0;">
              @if(isMapLoaded()) {
                <div style="height: 200px; overflow: hidden">
                  <app-map [editable]="false" [selectedItem]="selectedItem()" [pins]="pins()"></app-map>
                </div>
              }
            </div>
          </ion-accordion>
        </ion-accordion-group>
      </ion-content>
      }
    </ng-template>
  </ion-modal>
</ion-content>

<!-- Confirmation Popup -->
<app-popup
  [(isAlertOpen)]="openConfirmDelete"
  [heading]="'Delete'"
  [body]="confirmDeleteBody"
  [buttonType]="'confirm'"
  (popupClosed)="deletePopupClosed($event)"
></app-popup>
